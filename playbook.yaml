- name: Install packages
  hosts: localhost
  become: true
  become_method: ansible.builtin.sudo
  tasks:
    - name: Uninstall unwanted apps
      ansible.builtin.dnf:
        name:
          - abrt
          - gnome-calendar
          - gnome-contacts
          - gnome-maps
          - gnome-tour
          - gnome-weather
        state: absent
        autoremove: yes
    - name: Install GPG keys
      ansible.builtin.dnf:
        name: distribution-gpg-keys
        state: latest
    - name: Import RPM Fusion free key
      ansible.builtin.rpm_key:
        key: /usr/share/distribution-gpg-keys/rpmfusion/RPM-GPG-KEY-rpmfusion-free-fedora-{{ansible_distribution_major_version}}
        fingerprint: E9A4 91A3 DE24 7814 E7E0 67EA E06F 8ECD D651 FF2E
    - name: Import RPM Fusion non free key
      ansible.builtin.rpm_key:
        key: /usr/share/distribution-gpg-keys/rpmfusion/RPM-GPG-KEY-rpmfusion-nonfree-fedora-{{ansible_distribution_major_version}}
        fingerprint: 79BD B88F 9BBF 7391 0FD4 095B 6A2A F961 9484 3C65
    - name: Enable the RPM Fusion repository
      ansible.builtin.dnf:
        name:
          - "https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ansible_distribution_major_version}}.noarch.rpm"
          - "https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ansible_distribution_major_version}}.noarch.rpm"
        state: present
    - name: Ensure openh264 repository is enabled
      community.general.dnf_config_manager:
        name: fedora-cisco-openh264
        state: enabled
    - name: Upgrade packages
      ansible.builtin.dnf:
        name: "*"
        state: latest
    - name: Install the 'Development tools' package group
      ansible.builtin.dnf:
        name: "@Development tools"
        state: present
    - name: Install apps
      ansible.builtin.dnf:
        name:
          - gnome-shell-extension-appindicator
          - gnome-shell-extension-auto-move-windows
          - gnome-shell-extension-blur-my-shell
          - gnome-shell-extension-dash-to-dock
          - lutris
          - remmina
          - remmina-plugins-rdp
          - remmina-plugins-vnc
          - rhythmbox
          - siril
          - stellarium
          - syncthing
          - thunderbird
          - vlc
        state: latest
    - name: Enable Syncthing
      become: false
      ansible.builtin.systemd_service:
        name: syncthing
        enabled: true
        scope: user
        state: started
